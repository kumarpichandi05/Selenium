using Microsoft.Playwright;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

public class WebCrawler
{
    public static async Task Main()
    {
        string startUrl = "https://example.com";

        using var playwright = await Playwright.CreateAsync();
        await using var browser = await playwright.Chromium.LaunchAsync(new()
        {
            Headless = true
        });

        var page = await browser.NewPageAsync();
        await page.GotoAsync(startUrl);

        // Wait for links to load
        await page.WaitForSelectorAsync("a");

        // Get all href attributes
        var links = await page.EvalOnSelectorAllAsync<string[]>(
            "a[href]",
            "elements => elements.map(e => e.href)"
        );

        Console.WriteLine($"Total links found: {links.Length}");

        foreach (var link in links)
        {
            try
            {
                await ExtractPageData(browser, link);
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Failed: {link} - {ex.Message}");
            }
        }
    }

    private static async Task ExtractPageData(IBrowser browser, string url)
    {
        var newPage = await browser.NewPageAsync();
        await newPage.GotoAsync(url, new PageGotoOptions
        {
            WaitUntil = WaitUntilState.NetworkIdle
        });

        // Example: Extract title + full visible text
        string title = await newPage.TitleAsync();
        string bodyText = await newPage.InnerTextAsync("body");

        Console.WriteLine("=================================");
        Console.WriteLine($"URL: {url}");
        Console.WriteLine($"Title: {title}");
        Console.WriteLine($"Content Length: {bodyText.Length}");

        await newPage.CloseAsync();
    }
}